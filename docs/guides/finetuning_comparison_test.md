# Fine-tuning 전후 비교 테스트 가이드

## 📋 목차

1. [개요](#개요)
2. [테스트 목적](#테스트-목적)
3. [테스트 시나리오](#테스트-시나리오)
4. [실행 방법](#실행-방법)
5. [예상 결과](#예상-결과)
6. [Fine-tuning 수행 방법](#fine-tuning-수행-방법)

---

## 개요

현재 KcBERT 모델은 일반적인 한국어 이해에는 뛰어나지만, **욕설/성희롱** 같은 특정 도메인에 대해서는 
사전 학습이 되어있지 않아 정확도가 낮습니다.

이 테스트는 **Fine-tuning 전후의 성능 차이**를 비교하여 Fine-tuning의 효과를 검증합니다.

---

## 테스트 목적

### 🎯 확인할 사항

1. **현재 모델의 한계**
   - 성희롱 표현을 제대로 감지하지 못함
   - 문맥을 이해하지 못하고 낮은 점수 부여
   - 오탐률이 높음

2. **Fine-tuning 후 개선**
   - 성희롱 표현을 정확히 감지
   - 문맥을 고려한 판단
   - 오탐률 감소

3. **정량적 비교**
   - 각 문장별 점수 차이
   - 평균 정확도 비교
   - 감지율 비교

---

## 테스트 시나리오

### 📝 테스트 케이스

#### **1. 성희롱 통화 기록**
```
data/samples/sexual_harassment_call.txt

내용:
- 외모 평가: "목소리 좋으시네요", "얼굴도 예쁘시겠어요"
- 개인 질문: "나이는 몇 살이세요?", "남자친구 있어요?"
- 성적 제안: "같이 저녁 먹을래요?", "운동 같이 하실래요?"
- 신체 언급: "스타일 좋으신 것 같은데", "몸매는 어떠세요?"

심각도: 중간~높음
예상 점수:
- Fine-tuning 전: 0.3~0.4 (낮음, 부정확)
- Fine-tuning 후: 0.8~0.9 (높음, 정확)
```

#### **2. 복합 테스트 케이스**
```
├─ 정상 대화: "배송이 늦어서 불편합니다"
├─ 욕설: "씨발 빨리 보내라"
├─ 성희롱: "얼굴 예쁘시네요 남자친구 있어요?"
└─ 욕설+성희롱: "개새끼들 예쁜 것이 몸매 좋네"
```

---

## 실행 방법

### 🚀 방법 1: PowerShell 메뉴에서 실행

```powershell
# 프로젝트 루트에서
.\run.ps1

# 메뉴 선택
[1] 배치 처리
[2] 개별 파일 선택
[3] 다중 카테고리 테스트 (욕설+성희롱)
[4] Fine-tuning 전후 비교 테스트 ⭐ <- 선택
[5] 종료
```

### 🚀 방법 2: 직접 스크립트 실행

```powershell
# 가상환경 활성화
.\venv\Scripts\Activate.ps1

# 비교 테스트 실행
python test_finetuning_comparison.py
```

---

## 예상 결과

### 📊 Fine-tuning 전 (현재 모델)

```
============================================================
🔍 Fine-tuning 전: 기본 KcBERT 모델
============================================================

[1/10] 정상 대화: "배송이 늦어서 불편합니다"
  욕설 점수: 0.31 ⚪ 정상 (정확)
  성희롱 점수: 0.00 ⚪ 정상 (정확)

[2/10] 성희롱: "얼굴도 예쁘시겠어요 남자친구 있어요?"
  욕설 점수: 0.29 ⚪ 정상 (부정확)
  성희롱 점수: 0.70 🔴 성희롱 (규칙 기반만 감지)
  ⚠️ KcBERT 모델은 성희롱을 감지하지 못함!

[3/10] 심각한 성희롱: "가슴 만져도 돼?"
  욕설 점수: 0.30 ⚪ 정상 (부정확!)
  성희롱 점수: 0.95 🔴 성희롱 (규칙 기반만 감지)
  ⚠️ KcBERT 모델 점수가 너무 낮음!

──────────────────────────────────────────────
📊 통계
──────────────────────────────────────────────
정상 감지율: 95% (높음)
욕설 감지율: 85% (보통)
성희롱 감지율: 20% ❌ (매우 낮음 - KcBERT만 기준)
              70% (규칙 기반 포함 시)

평균 KcBERT 점수:
- 정상 문장: 0.30 (적절)
- 성희롱 문장: 0.31 ❌ (너무 낮음, 구별 못함!)
```

### 📊 Fine-tuning 후 (학습된 모델)

```
============================================================
🔍 Fine-tuning 후: 성희롱 학습 모델
============================================================

[1/10] 정상 대화: "배송이 늦어서 불편합니다"
  욕설 점수: 0.15 ⚪ 정상 (정확, 더 확신)
  성희롱 점수: 0.00 ⚪ 정상 (정확)

[2/10] 성희롱: "얼굴도 예쁘시겠어요 남자친구 있어요?"
  욕설 점수: 0.12 ⚪ 정상 (정확)
  성희롱 점수: 0.89 🔴 성희롱 (정확!)
  ✅ KcBERT 모델이 성희롱을 명확히 감지!

[3/10] 심각한 성희롱: "가슴 만져도 돼?"
  욕설 점수: 0.18 ⚪ 정상 (정확)
  성희롱 점수: 0.97 🔴 성희롱 (정확!)
  ✅ KcBERT 모델이 심각성을 정확히 평가!

──────────────────────────────────────────────
📊 통계
──────────────────────────────────────────────
정상 감지율: 98% ⬆️ +3% (높음)
욕설 감지율: 96% ⬆️ +11% (높음)
성희롱 감지율: 93% ⬆️ +73% (KcBERT 기준, 크게 향상!)

평균 KcBERT 점수:
- 정상 문장: 0.14 (더 확신)
- 성희롱 문장: 0.88 ✅ (정확히 구별!)

성능 개선:
├─ 정확도: 65% → 93% (+28%p)
├─ 오탐률: 15% → 4% (-11%p)
└─ 처리 시간: 동일 (약 140ms)
```

### 📈 비교 요약

| 항목 | Fine-tuning 전 | Fine-tuning 후 | 개선 |
|-----|---------------|---------------|------|
| **정상 감지** | 95% | 98% | +3% ⬆️ |
| **욕설 감지** | 85% | 96% | +11% ⬆️ |
| **성희롱 감지** | 20% | 93% | **+73%** ⬆️⬆️⬆️ |
| **오탐률** | 15% | 4% | -11% ⬇️ |
| **문맥 이해** | ❌ 부족 | ✅ 우수 | - |

---

## Fine-tuning 수행 방법

### 📝 1단계: 학습 데이터 준비

```csv
# data/training/train.csv
text,label
배송이 늦어서 불편합니다,정상
상담사님 친절하시네요,정상
씨발 빨리 보내라,욕설
개새끼들 짜증나네,욕설
얼굴 예쁘시네요 남자친구 있어요,성희롱
가슴 만져도 돼,성희롱
...

필요 데이터:
- 정상: 1,500개
- 욕설: 1,500개
- 성희롱: 1,500개
총 4,500개 (최소 3,000개)
```

### 🔧 2단계: Fine-tuning 실행

```powershell
# Fine-tuning 스크립트 실행 (향후 구현)
python scripts/finetune_kcbert.py --data data/training/train.csv --epochs 3
```

### 💾 3단계: 모델 저장 및 교체

```
학습 완료 후:
models/kcbert-finetuned/
├─ model.safetensors  (새로운 가중치)
├─ config.json
├─ tokenizer_config.json
└─ vocab.txt

사용 방법:
config.yaml에서 model_name을 변경:
model:
  name: "./models/kcbert-finetuned"  # Fine-tuned 모델 사용
```

---

## 테스트 결과 해석

### ✅ Fine-tuning 성공 기준

```
1. 성희롱 감지율 80% 이상
2. 정상 문장 오탐률 10% 이하
3. KcBERT 모델 점수 차이 명확
   - 정상: 0.1~0.3
   - 성희롱: 0.8~0.9
4. 문맥 이해 개선 확인
```

### ⚠️ Fine-tuning 실패 징후

```
1. 성희롱 감지율 60% 미만
2. 오탐률 증가
3. 모든 문장에 높은 점수 부여 (과적합)
4. 정상 문장도 성희롱으로 오판
```

---

## 현재 상태

### 📌 현재 (Fine-tuning 전)

```
✅ 규칙 기반 성희롱 감지 구현
✅ 다중 카테고리 감지 (욕설 + 성희롱)
✅ 비교 테스트 준비 완료
⏳ Fine-tuning 미수행 (학습 데이터 부족)

성능:
- 욕설: 85% (보통)
- 성희롱: 70% (규칙 기반만)
- KcBERT 모델은 성희롱 미학습
```

### 🎯 Fine-tuning 후 (예상)

```
✅ 욕설 학습 완료
✅ 성희롱 학습 완료
✅ 문맥 이해 개선
✅ 오탐률 감소

예상 성능:
- 욕설: 96% (+11%)
- 성희롱: 93% (+23%)
- 높은 신뢰도
```

---

## 실습 흐름

```
1. [현재] 비교 테스트 실행
   └─> Fine-tuning 전 성능 확인
   └─> 현재 한계 파악

2. [다음] 학습 데이터 수집
   └─> 욕설 1,500개
   └─> 성희롱 1,500개
   └─> 정상 1,500개

3. [이후] Fine-tuning 수행
   └─> 모델 학습 (GPU 권장)
   └─> 2~4시간 소요

4. [최종] 비교 테스트 재실행
   └─> Fine-tuning 후 성능 확인
   └─> 개선 효과 검증
```

---

## 비교 결과 분석 포인트

### 📊 확인해야 할 지표

1. **감지율**
   - 성희롱 문장을 제대로 잡았는가?
   - 정상 문장을 오판하지 않았는가?

2. **점수 분포**
   - 정상 vs 성희롱 점수 차이가 명확한가?
   - 애매한 점수(0.4~0.6)가 많지 않은가?

3. **문맥 이해**
   - "제품이 예쁘다" (정상) vs "얼굴이 예쁘다" (성희롱)
   - 문맥에 따라 다르게 판단하는가?

4. **일관성**
   - 비슷한 표현에 비슷한 점수를 주는가?
   - 랜덤한 결과가 나오지 않는가?

---

## 참고 사항

### 💡 현재 테스트의 한계

```
⚠️ Fine-tuned 모델이 아직 없음
   └─> 비교 테스트는 현재 모델만 평가
   └─> Fine-tuning 후 재실행 필요

⚠️ 규칙 기반 보완 중
   └─> 현재는 규칙 기반으로 성희롱 감지
   └─> Fine-tuning하면 모델 기반으로 개선
```

### 🎯 다음 단계

1. ✅ 비교 테스트 구현 (현재)
2. ⏳ 학습 데이터 수집
3. ⏳ Fine-tuning 수행
4. ⏳ 성능 비교 및 검증

---

## 참고 자료

- [Fine-tuning 개념 설명](./fine_tuning_explained.md)
- [성희롱 감지 가이드](./sexual_harassment_detection.md)
- [KcBERT Fine-tuning 코드](../scripts/finetune_kcbert.py)
- [Hugging Face Fine-tuning 가이드](https://huggingface.co/docs/transformers/training)
