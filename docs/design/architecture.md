# KcBERT 기반 통화 내용 폭언/욕설 감지 시스템 설계서

## 1. 프로젝트 개요

### 1.1 목적
통화 내용에서 폭언, 욕설 등의 공격적인 언어를 자동으로 감지하여 고객 서비스 품질 관리 및 상담원 보호에 활용

### 1.2 핵심 기술
- **NLP 모델**: KcBERT (Korean comments BERT)
  - 한국어 댓글 데이터로 사전 학습된 BERT 모델
  - 욕설, 혐오 표현, 공격적 언어 감지에 최적화
  - Hugging Face Transformers 기반

### 1.3 주요 기능
- 텍스트 파일 기반 통화 내용 입력
- KcBERT를 활용한 공격성 분석
- 공격성 점수 산출 및 반환 (0~1 범위)
- 욕설/폭언 감지 결과 리포트 생성

## 2. 시스템 아키텍처

### 2.1 전체 구조

```
┌─────────────────────────────────────────────────────────┐
│                    입력 레이어                            │
│  ┌────────────────────────────────────────────────┐     │
│  │  통화 내용 텍스트 파일 (.txt)                    │     │
│  │  - 실시간 STT 변환 결과                          │     │
│  │  - 저장된 통화 기록                              │     │
│  └────────────────────────────────────────────────┘     │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              전처리 레이어                                 │
│  ┌────────────────────────────────────────────────┐     │
│  │  텍스트 전처리 (TextPreprocessor)                │     │
│  │  - 파일 읽기 및 인코딩 처리                       │     │
│  │  - 특수문자/공백 정규화                           │     │
│  │  - 문장 분리 (선택적)                            │     │
│  └────────────────────────────────────────────────┘     │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│               모델 레이어                                  │
│  ┌────────────────────────────────────────────────┐     │
│  │  KcBERT 감지 엔진 (AbusiveDetector)             │     │
│  │                                                  │     │
│  │  ┌──────────────────────────────────┐          │     │
│  │  │  KcBERT Tokenizer                │          │     │
│  │  │  - 텍스트 → 토큰 변환             │          │     │
│  │  │  - 패딩/트런케이션                │          │     │
│  │  └──────────────────────────────────┘          │     │
│  │                  ▼                               │     │
│  │  ┌──────────────────────────────────┐          │     │
│  │  │  KcBERT Model                    │          │     │
│  │  │  - beomi/kcbert-base             │          │     │
│  │  │  - 공격성 분류 레이어              │          │     │
│  │  └──────────────────────────────────┘          │     │
│  └────────────────────────────────────────────────┘     │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              출력 레이어                                   │
│  ┌────────────────────────────────────────────────┐     │
│  │  결과 생성 (ResultFormatter)                     │     │
│  │  - 공격성 점수 (0.0 ~ 1.0)                       │     │
│  │  - 감지 여부 (True/False)                        │     │
│  │  - 신뢰도 점수                                    │     │
│  │  - 분석 결과 JSON                                │     │
│  └────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────┘
```

### 2.2 디렉토리 구조

```
workspace_KcBERT/
├── src/                          # 소스 코드
│   ├── __init__.py
│   ├── detector.py               # 메인 감지 엔진
│   ├── preprocessor.py           # 텍스트 전처리
│   ├── model_loader.py           # KcBERT 모델 로더
│   └── utils.py                  # 유틸리티 함수
├── data/                         # 데이터 디렉토리
│   ├── samples/                  # 예제 통화 내용
│   │   ├── normal_call.txt       # 정상 통화
│   │   ├── abusive_call.txt      # 욕설 포함 통화
│   │   └── mixed_call.txt        # 혼합 통화
│   └── results/                  # 분석 결과 저장
├── models/                       # 모델 캐시 (자동 생성)
│   └── kcbert/                   # KcBERT 모델 파일
├── tests/                        # 테스트 코드
│   ├── __init__.py
│   ├── test_detector.py
│   └── test_preprocessor.py
├── docs/                         # 문서
│   ├── design/
│   │   └── architecture.md       # 본 문서
│   └── guides/
│       └── usage.md              # 사용 가이드
├── requirements.txt              # 의존성 패키지
├── config.yaml                   # 설정 파일
├── main.py                       # 실행 스크립트
└── README.md                     # 프로젝트 소개
```

## 3. 핵심 컴포넌트 설계

### 3.1 TextPreprocessor (전처리기)

**책임**: 입력 텍스트 정제 및 표준화

**주요 기능**:
- 텍스트 파일 읽기 (UTF-8 인코딩)
- 불필요한 공백, 특수문자 제거
- 문장 분리 (선택적)
- 텍스트 길이 제한 처리

**인터페이스**:
```python
class TextPreprocessor:
    def load_from_file(self, filepath: str) -> str
    def clean_text(self, text: str) -> str
    def split_sentences(self, text: str) -> List[str]
```

### 3.2 AbusiveDetector (감지 엔진)

**책임**: KcBERT를 활용한 욕설/폭언 감지

**주요 기능**:
- KcBERT 모델 초기화 및 로드
- 텍스트 → 공격성 점수 변환
- 배치 처리 지원
- GPU/CPU 자동 감지

**인터페이스**:
```python
class AbusiveDetector:
    def __init__(self, model_name: str = "beomi/kcbert-base")
    def load_model(self)
    def predict(self, text: str) -> Dict[str, Any]
    def predict_batch(self, texts: List[str]) -> List[Dict[str, Any]]
```

**출력 형식**:
```python
{
    "text": "입력 텍스트",
    "is_abusive": True/False,
    "confidence": 0.95,          # 모델 신뢰도
    "abusive_score": 0.87,       # 공격성 점수 (0~1)
    "threshold": 0.5,            # 감지 임계값
    "processing_time": 0.234     # 처리 시간 (초)
}
```

### 3.3 ModelLoader (모델 로더)

**책임**: KcBERT 모델 및 토크나이저 관리

**주요 기능**:
- Hugging Face에서 모델 다운로드
- 로컬 캐싱 처리
- 모델 버전 관리

**인터페이스**:
```python
class ModelLoader:
    def __init__(self, model_name: str, cache_dir: str)
    def load_tokenizer(self) -> AutoTokenizer
    def load_model(self) -> AutoModelForSequenceClassification
```

## 4. 데이터 플로우

### 4.1 처리 흐름

```
1. 입력 단계
   └─> 텍스트 파일 읽기 (UTF-8)

2. 전처리 단계
   ├─> 텍스트 정규화
   ├─> 불필요한 문자 제거
   └─> 길이 제한 확인 (512 토큰)

3. 토큰화 단계
   ├─> KcBERT Tokenizer 적용
   ├─> 패딩/트런케이션
   └─> Attention Mask 생성

4. 모델 추론 단계
   ├─> KcBERT 순전파
   ├─> Softmax 활성화
   └─> 공격성 확률 계산

5. 후처리 단계
   ├─> 점수 정규화 (0~1)
   ├─> 임계값 비교
   └─> 결과 JSON 생성

6. 출력 단계
   └─> 결과 반환/저장
```

### 4.2 예제 데이터

**정상 통화 (normal_call.txt)**:
```
고객: 안녕하세요, 제품 문의 드립니다.
상담원: 네 안녕하세요. 무엇을 도와드릴까요?
고객: A 상품의 배송 기간이 궁금합니다.
상담원: A 상품은 주문 후 2-3일 이내 배송됩니다.
고객: 감사합니다. 도움이 되었어요.
```

**욕설 포함 통화 (abusive_call.txt)**:
```
고객: 야 거기 배송 왜 이렇게 느린거야?
상담원: 죄송합니다. 확인해보겠습니다.
고객: 확인은 무슨, 이 XX들아. 빨리 안되냐고.
상담원: 고객님, 욕설은 자제 부탁드립니다.
고객: 시끄러워. 너네 때문에 짜증나 죽겠어.
```

## 5. 기술 스택

### 5.1 핵심 라이브러리

| 라이브러리 | 버전 | 용도 |
|-----------|------|------|
| transformers | ≥4.30.0 | KcBERT 모델 로드 |
| torch | ≥2.0.0 | 딥러닝 프레임워크 |
| tokenizers | ≥0.13.0 | 고속 토큰화 |
| numpy | ≥1.24.0 | 수치 연산 |
| pyyaml | ≥6.0 | 설정 파일 파싱 |

### 5.2 KcBERT 모델 상세

- **모델명**: beomi/kcbert-base
- **파라미터 수**: 110M
- **최대 시퀀스 길이**: 512 토큰
- **사전 학습 데이터**: 한국어 댓글 (네이버 뉴스 등)
- **Fine-tuning 필요**: 통화 데이터에 맞춰 추가 학습 권장

## 6. 성능 및 제약사항

### 6.1 성능 목표

- **처리 속도**: 텍스트당 < 1초 (CPU 기준)
- **정확도**: F1 Score > 0.85
- **메모리 사용량**: < 2GB (모델 로드 시)

### 6.2 제약사항

- **텍스트 길이**: 최대 512 토큰 (약 300-400 단어)
- **언어**: 한국어만 지원
- **실시간 처리**: STT 결과 대기 필요
- **문맥 의존**: 문맥에 따른 오탐/미탐 가능

### 6.3 개선 방향

1. **Fine-tuning**: 실제 통화 데이터로 모델 재학습
2. **앙상블**: 여러 모델 조합으로 정확도 향상
3. **규칙 기반 보완**: 특정 욕설 패턴 사전 필터링
4. **실시간 처리**: 스트리밍 기반 점진적 분석

## 7. 보안 및 개인정보

### 7.1 데이터 보호

- 통화 내용은 로컬에서만 처리
- 외부 API 호출 없음 (모델 로컬 실행)
- 분석 결과 암호화 저장 옵션

### 7.2 개인정보 처리

- 개인식별정보 자동 마스킹 필요
- 통화 내용 저장 시 동의 절차 필요
- GDPR/개인정보보호법 준수

## 8. 배포 및 운영

### 8.1 설치 요구사항

- **Python**: 3.8 이상
- **OS**: Windows/Linux/MacOS
- **RAM**: 최소 4GB, 권장 8GB
- **저장공간**: 모델 캐시 약 500MB

### 8.2 실행 방법

```bash
# 의존성 설치
pip install -r requirements.txt

# 단일 파일 분석
python main.py --input data/samples/abusive_call.txt

# 배치 처리
python main.py --input data/samples/ --batch

# 결과 저장
python main.py --input test.txt --output results/result.json
```

### 8.3 모니터링

- 처리 시간 로깅
- 오탐/미탐 케이스 수집
- 모델 성능 지표 추적

## 9. 테스트 전략

### 9.1 단위 테스트

- 각 컴포넌트별 독립 테스트
- 엣지 케이스 처리 검증

### 9.2 통합 테스트

- 전체 파이프라인 테스트
- 다양한 통화 시나리오 검증

### 9.3 성능 테스트

- 대용량 데이터 처리 테스트
- 메모리 누수 체크

## 10. 향후 확장 계획

### 10.1 단기 (1-3개월)

- [ ] 기본 감지 시스템 구현
- [ ] 예제 데이터 생성 및 테스트
- [ ] 성능 벤치마크

### 10.2 중기 (3-6개월)

- [ ] 실제 통화 데이터로 Fine-tuning
- [ ] 웹 API 서버 구축
- [ ] 대시보드 개발

### 10.3 장기 (6개월 이상)

- [ ] 다국어 지원 (영어, 일본어 등)
- [ ] 실시간 스트리밍 분석
- [ ] 감정 분석 기능 추가
- [ ] 자동 대응 시스템 연동

## 11. 참고 자료

### 11.1 KcBERT 관련

- KcBERT GitHub: https://github.com/Beomi/KcBERT
- Hugging Face Model: https://huggingface.co/beomi/kcbert-base
- 논문: "KcBERT: Korean Comments BERT"

### 11.2 기술 문서

- Transformers 공식 문서: https://huggingface.co/docs/transformers
- PyTorch 공식 문서: https://pytorch.org/docs

---

**문서 버전**: 1.0  
**작성일**: 2026-01-21  
**작성자**: AI Assistant  
**최종 수정일**: 2026-01-21
